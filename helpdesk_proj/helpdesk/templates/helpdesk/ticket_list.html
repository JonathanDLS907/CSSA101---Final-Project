{% extends "helpdesk/base.html" %}

{% block title %}Tickets{% endblock %}

{% block content %}
<h2>All Tickets</h2>

<!-- Search + priority filter -->
<form method="get" style="margin-bottom: 12px;">
  <input type="text" name="q" placeholder="Search title or description" value="{{ q }}">

  <select name="priority">
    <option value="">All priorities</option>
    <option value="H" {% if selected_priority == 'H' %}selected{% endif %}>High</option>
    <option value="M" {% if selected_priority == 'M' %}selected{% endif %}>Medium</option>
    <option value="L" {% if selected_priority == 'L' %}selected{% endif %}>Low</option>
  </select>

  <button type="submit">Search</button>
</form>

{% for ticket in tickets %}
<div class="card">
  <a href="{% url 'helpdesk:ticket_detail' ticket.pk %}"><strong>#{{ ticket.id }} - {{ ticket.title }}</strong></a>

  <p class="small">
    Status: {{ ticket.get_status_display }} •
    Priority: <span class="priority priority-{{ ticket.priority }}">{{ ticket.get_priority_display }}</span> •

    {% if ticket.due_at %}
      Due: {{ ticket.due_at|date:"Y-m-d H:i" }}
      {% if ticket.is_overdue %}
        <strong style="color:red">• OVERDUE</strong>
      {% endif %}
      •
    {% else %}
      Due: —
      •
    {% endif %}

    By {{ ticket.reporter_name }} • {{ ticket.created_at|date:"Y-m-d H:i" }}
  </p>

  <p>{{ ticket.description|truncatewords:25 }}</p>
</div>
{% empty %}
<p>No tickets found.</p>
{% endfor %}
{% endblock %}
